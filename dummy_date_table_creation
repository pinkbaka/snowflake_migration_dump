INSERT INTO "MTL_LOAD_PRE"."PUBLIC"."TARGET_CAMPAIGNMEMBER" (ID, CAMPAIGNID, STATUS, CREATEDDATE)
VALUES ('DUMMY', '7015A000001jvqkQAA', 'Engaged', '12/31/2021');

INSERT INTO "MTL_LOAD_PRE"."PUBLIC"."TARGET_CAMPAIGNMEMBER" (ID, CAMPAIGNID, STATUS, CREATEDDATE)
VALUES ('DUMMY', '7015A000001jvqkQAA', 'Engaged', '6/30/2021');

INSERT INTO "MTL_LOAD_PRE"."PUBLIC"."TARGET_CAMPAIGNMEMBER" (ID, CAMPAIGNID, STATUS, CREATEDDATE)
VALUES ('DUMMY', '7015A000001jvqkQAA', 'Engaged', '9/30/2021');


SELECT TOP 10  name,id FROM "MTL_LOAD_PRE"."PUBLIC"."TARGET_CAMPAIGNMEMBER"
where name like '%Demo%';


SELECT TOP 10  name,id FROM "MTL_LOAD_PRE"."PUBLIC"."TARGET_CAMPAIGN"
where name like '%Web - Demo%';



ALTER SESSION SET WEEK_START = 7;
alter session set week_of_year_policy=0;

CREATE OR REPLACE TABLE "TABLEAU_REPORTING"."PUBLIC"."SNW_DATE_DIM_Tmp" (
MY_DATE DATE NOT NULL
,YEAR SMALLINT NOT NULL
,MONTH SMALLINT NOT NULL
,MONTH_NAME CHAR(3) NOT NULL
,DAY_OF_MON SMALLINT NOT NULL
,DAY_OF_WEEK VARCHAR(9) NOT NULL
,WEEK_OF_YEAR SMALLINT NOT NULL
,DAY_OF_YEAR SMALLINT NOT NULL
,WEEK_OF_QUARTER SMALLINT NOT NULL
,WEEK_OF_QUARTER_RPT SMALLINT NOT NULL
)
AS
WITH CTE_MY_DATE AS (
SELECT DATEADD(DAY, SEQ4(), '2000-01-01') AS MY_DATE
FROM TABLE(GENERATOR(ROWCOUNT=>10000))
-- Number of days after reference date in previous line
)

SELECT MY_DATE
,YEAR(MY_DATE)
,MONTH(MY_DATE)
,MONTHNAME(MY_DATE)
,DAY(MY_DATE)
,DAYOFWEEK(MY_DATE)
,WEEKOFYEAR(MY_DATE)
,DAYOFYEAR(MY_DATE)
,(WEEKOFYEAR(MY_DATE)%13)+1
,case when WEEKOFYEAR(MY_DATE) = 53 then 13 else (WEEKOFYEAR(MY_DATE)%13) end
FROM CTE_MY_DATE
;


CREATE OR REPLACE VIEW "TABLEAU_REPORTING"."PUBLIC"."SNW_DATE_DIM" AS
  (
    SELECT *
    ,case when WEEK_OF_QUARTER_RPT = 0 then 13 else WEEK_OF_QUARTER_RPT end as WEEK_OF_QUARTER_RPTDATE
    FROM  "TABLEAU_REPORTING"."PUBLIC"."SNW_DATE_DIM_Tmp"
  );
  
  use "MTL_LOAD_PRE";
create or replace sequence seq_week start = 0 increment = 6;

CREATE OR REPLACE TABLE  "TABLEAU_REPORTING"."PUBLIC"."SNW_DUMMY_RECORDS" AS
    (
      SELECT 'DUMMY' as ID, DATEADD(DAY, SEQ4(), date('2021-01-01')+seq_week.nextval) AS CREATEDDATE
      FROM TABLE(GENERATOR(ROWCOUNT=>100))
    );
    
 SELECT * FROM "TABLEAU_REPORTING"."PUBLIC"."SNW_DUMMY_RECORDS";
 
 SELECT *
 ,case when WEEK_OF_QUARTER_RPT = 0 then 13 else WEEK_OF_QUARTER_RPT end
 --, case when WEEK_OF_YEAR = 53 then 0 else WEEK_OF_YEAR end
 FROM "TABLEAU_REPORTING"."PUBLIC"."SNW_DATE_DIM"
 where YEAR >= 2021;

 
